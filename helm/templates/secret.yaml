{{- if not .Values.vaultSecretsOperator.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "recipe-ai.fullname" . }}-secret
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "recipe-ai.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
data:
  anthropic-api-key: {{ .Values.secrets.anthropicApiKey | b64enc }}
  secret-key: {{ .Values.secrets.secretKey | b64enc }}
  database-url: {{ printf "postgresql://%s:%s@%s-postgres:5432/%s?sslmode=disable" .Values.postgres.username .Values.postgres.password (include "recipe-ai.fullname" .) .Values.postgres.database | b64enc }}
{{- end }}